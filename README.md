Описание калькулятора 3D-печати (GUI, .3MF/.STL)
Небольшое настольное приложение на Tkinter для расчёта веса и стоимости печати по 3D-модели. Поддерживает точное чтение .3MF (включая сборки и масштаб/позиции из слайсера) и быстрый расчёт объёма .STL.
Ключевые возможности
•	Форматы:
o	.3MF — чтение всех 3D/*.model, поддержка <build><item> (позиции/масштабы из слайсера), и Production extension p:path (ссылки на объекты в других .model внутри архива).
o	.STL (binary) — два режима: построение сетки для «точного» объёма по тетраэдрам и потоковый расчёт объёма напрямую из файла (без создания сетки).
•	Корректные трансформации 3MF:
o	Разбор 12-элементной матрицы transform (row-major).
o	Композиция матриц при обходе сборки (item → component → …).
o	Учёт единиц измерения модели (micron/mm/cm/m/inch/foot).
o	Быстрый объём для 3MF: базовый объём × |det(полной матрицы)| — корректно учитывает масштаб (например, ×8 при 200%).
•	Методы оценки объёма модели:
o	Точный (тетраэдры) — через ориентированные объёмы треугольников.
o	Ограничивающий параллелепипед (BBox) — наихудшая оценка, работает очень быстро.
o	Потоковый STL — быстрый объём напрямую из бинарного STL (без построения топологии).
•	Учёт FDM-параметров (по модели):
o	Стенки: по площади поверхности (см²) × число стенок × ширина линии.
o	Крышки/донышки: по площади XY-проекции bbox × число верх/низ слоёв × высота слоя.
o	Заполнение: (объём модели − корка − крышки) × % заполнения.
o	Защита от переоценки корки: корка ≤ 60% объёма модели (эвристика).
•	Материалы и прайс:
o	Встроенный справочник плотностей (г/см³) и цен (₽/г) по ряду материалов.
o	Выбор материала из выпадающего списка + поле % заполнения.
•	Вывод и агрегирование:
o	По каждому объекту: объём модели, итоговый вес (г) и стоимость (₽).
o	Итого по файлу: суммарный вес, стоимость, время расчёта.
•	Диагностика/валидация (статус-плашка):
o	Имя файла, встреченные единицы измерения, количество item/component, число внешних p:path.
o	Диапазон детерминант матриц item (помогает заметить неожиданный масштаб/отражение).
Интерфейс
•	Переключатель метода базового объёма: BBox или Тетраэдры (по умолчанию).
•	Чекбоксы:
o	Быстрый объём — расчёт только по заполнению (без стенок/крышек).
o	Потоковый STL — считать объём бинарного STL напрямую из файла.
•	Выбор материала и поле % заполнения.
•	Кнопка «Загрузить 3D файл» (.3mf/.stl).
•	Прокручиваемое окно результатов с детализацией по объектам + «ИТОГО».
Как это работает (вкратце)
1.	Загрузка: парсер определяет формат и для .3MF строит кэш по всем 3D/*.model.
2.	Сборки: если есть <build><item>, каждое item разворачивается с учётом его transform. Для составных объектов рекурсивно складываются дочерние компоненты (с композициями матриц), включая production:p:path.
3.	Объёмы:
o	3MF: базовый объём сетки умножается на |det(R)| полной матрицы (учёт масштаба).
o	STL: «тетраэдры» из построенной сетки или «потоковый» объём без сетки.
4.	FDM-добавки: поверх базового объёма модели добавляются стенки и крышки/донышки, затем учитывается % заполнения.
5.	Масса/цена: рассчитываются по плотности и цене выбранного материала.
Быстродействие
•	Потоковый расчёт STL экономит память и ускоряет обработку больших файлов.
•	Для 3MF «быстрый объём» использует детерминант матрицы без копирования геометрии.
•	Векторизированные операции numpy для объёмов и площадей.
Ограничения и примечания
•	STL: потоковый режим работает только с бинарным STL; для ASCII используйте обычный режим (с построением сетки) или конвертируйте в бинарный.
•	3MF: поддерживаются типовые структуры object/mesh/triangles и сборки build/items; материалы/цвета/решётки не влияют на расчёт.
•	Эвристика корки ≤ 60% помогает избежать нереалистично большого вклада стенок/крышек на сложных тонкостенных моделях. При желании её можно ослабить/отключить в коде.
•	Сейчас приложение работает как GUI-скрипт; CLI и пакетная структура не обязательны, но легко добавляются при росте проекта.
Типовые сценарии
•	Проверка, как изменится вес и стоимость при масштабировании модели в слайсере (3MF учитывает все трансформации).
•	Быстрая оценка стоимости по большому STL без загрузки в память.
•	Сравнение «быстрого» и «подробного» подсчёта (только заполнение vs с коркой).
•	Диагностика неожиданного веса через статус-плашку (единицы, количество items, детерминанты трансформаций).

